var db = require('orchestrate')('893352c5-f1bf-4a27-b61c-31f646586c30');

var pushToOrchestrate = function (arrayOfLocations){
	//this.arrayOfLocations = arrayOfLocations;

	console.log("Array in module");
	//console.log(arrayOfLocations);
  arrayOfLocations.forEach(function(item, index) {

    var data = JSON.parse(item);

    function WindInstance(name, windSpeed, windBearing, icon, time){
      this.name = name;
      this.windSpeed = windSpeed;
      this.windBearing = windBearing;
      this.icon = icon;
      this.time = time;

    };

    function LocationInstance(currentInstance, dailyInstance, hourlyInstance){
      this.current = currentInstance;
      this.daily = dailyInstance;
      this.hourly = hourlyInstance;
    };

    function nameLocation (latitude) {
      var name = "";

      switch(latitude) {
        case "722":
           return name = "The Hatchery";
        case "716":
           return name = "Hood River Event Site";
        case "687":
          return name = "Rock Creek";
        case "676":
           return name = "Doug's Beach";
        case "694":
          return name = "Rufus";
        case "729":
           return name = "Roosevelt";
        case "701":
          return name = "Viento";
        case "693":
          return name = "Stevenson";
        case "696":
          return name = "Lyle Sand Bar";
        case "552":
          return name = "Rooster Rock";
        default:
           return name = "default";
      };
    };
    var current = data.currently; //current data
    var latitude = data.latitude.toString().slice(3,7); //our lat to ID with	
    var daily = data.daily.data; //daily forecast
    var hourly = data.hourly.data;  //hourly forecast
    // console.log('CURRENT::::::::::::::');
    // console.log(current);
    // console.log('DAILY:::::::::::::::::');
    // console.log(daily.data);
    // console.log('HOURLY::::::::::::::::');
    // console.log(hourly.data);

    var currentWind = new WindInstance(
      nameLocation(latitude),
      current.windSpeed, current.windBearing, 
      current.icon, current.time);
   
    db.put('current', currentWind.name, currentWind);



    console.log("NEW CURRENT WINDINSTANCE:");
    //console.log(currentWind);

    var dailyWind = [];
    daily.forEach(function (day){
      dailyWind.push(new WindInstance(
      	nameLocation(latitude),
        day.windSpeed, day.windBearing,
        day.icon, day.time));
    });


    //db.put('TEST3', currentWind.name, 345);
    //db.put('daily', currentWind.name, dailyWind);
    //console.log("NEW DAILY WINDINSTANCE:");
    //console.log (dailyWind);

    //////////////

    var hourlyWind = [];
    hourly.forEach(function (hour){
      hourlyWind.push(new WindInstance(
      	nameLocation(latitude),
        hour.windSpeed, hour.windBearing,
        hour.icon, hour.time));
    });

    var locationInstance = new LocationInstance(currentWind, dailyWind, hourlyWind);

    db.put("Locations", currentWind.name, locationInstance);
    //console.log("NEW HOURLY WINDINSTANCE:");
    //console.log (hourlyWind);
  });
  

	


  console.log("lets get rufus: ");
  db.get('current', 'Rufus')
  .then(function(result){
    console.log(result.body);
  })
  .fail(function (err) {

  });



  //db.put('current', 'burnsideDigital', currentWind);

};


module.exports = pushToOrchestrate;